# –ü—Ä–∞–∫—Ç–∏–∫–∞

## **–®–ê–ì 1: –ü–†–û–í–ï–†–ö–ê –£–°–¢–ê–ù–û–í–ö–ò FreeIPA**

```bash
systemctl status ipa
```

```bash
sudo apt update
sudo apt install -y freeipa-server freeipa-server-dns
```

```bash
ipa realm
```

**–î–û–õ–ñ–ù–û –ü–û–ö–ê–ó–ê–¢–¨:** `reaskills.cyber`

```bash
# –ù–ê –ß–ï–ú–ü–ò–û–ù–ê–¢–ï –£–ñ–ï –î–û–õ–ñ–ù–û –ë–´–¢–¨ –ù–ê–°–¢–†–û–ï–ù–û!
# –ù–æ –µ—Å–ª–∏ –Ω–µ—Ç:
sudo ipa-server-install --domain=reaskills.cyber --realm=REASKILLS.CYBER --setup-dns --forwarder=8.8.8.8

```

## **–®–ê–ì 2: –ü–û–õ–£–ß–ò–¢–¨ ADMIN –î–û–°–¢–£–ü**

**–í–æ–π—Ç–∏ –∫–∞–∫ admin:**

```bash
kinit admin
```

**–í–í–ï–î–ò –ü–ê–†–û–õ–¨ ADMIN** (–æ–±—ã—á–Ω–æ –≤ –∑–∞–¥–∞–Ω–∏–∏ –Ω–∞–ø–∏—Å–∞–Ω, –Ω–∞–ø—Ä–∏–º–µ—Ä `P@ssw0rd`)

**–ü–†–û–í–ï–†–ò–¢–¨:**

```bash
klist
```

**–î–û–õ–ñ–ù–û –ü–û–ö–ê–ó–ê–¢–¨:**

```bash
Ticket cache: FILE:/tmp/krb5cc_0
Default principal: admin@REASKILLS.CYBER
```

## **–®–ê–ì 3: –°–û–ó–î–ê–¢–¨ –ì–†–£–ü–ü–´**

```bash
ipa group-add Administrators --desc="Admin users"
ipa group-add Worker --desc="Worker users"
ipa group-add TopManager --desc="Top managers"
```

**–ü–†–û–í–ï–†–ò–¢–¨:**

```bash
ipa group-find
```

## **–®–ê–ì 4: –°–û–ó–î–ê–¢–¨ 71 –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø (–°–ö–†–ò–ü–¢–û–ú)**

**–°–æ–∑–¥–∞–π —Ñ–∞–π–ª —Å–∫—Ä–∏–ø—Ç–∞:**

```bash
nano ~/create_users.sh
```

```bash
#!/bin/bash

for i in {1..40}; do
  echo -e "P@ssw0rdAdmin\nP@ssw0rdAdmin" | ipa user-add user$i --first=User --last=$i --email=user$i@reaskills.cyber --password 2>/dev/null
  ipa group-add-member Administrators --users=user$i 2>/dev/null
done

for i in {41..80}; do
  echo -e "P@ssw0rdWorker\nP@ssw0rdWorker" | ipa user-add user$i --first=User --last=$i --email=user$i@reaskills.cyber --password 2>/dev/null
  ipa group-add-member Worker --users=user$i 2>/dev/null
done

for i in {100..130}; do
  echo -e "P@ssw0rdTop\nP@ssw0rdTop" | ipa user-add superuser$i --first=SuperUser --last=$i --email=superuser$i@reaskills.cyber --password 2>/dev/null
  ipa group-add-member TopManager --users=superuser$i 2>/dev/null
done

```

```bash
chmod +x ~/create_users.sh
kinit admin
./create_users.sh

```

```bash
# –ü–æ—Å—á–∏—Ç–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
ipa user-find | grep "User login" | wc -l

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —á–ª–µ–Ω–æ–≤ –≥—Ä—É–ø–ø—ã
ipa group-show Administrators
```

## **–®–ê–ì 5: –ù–ê–°–¢–†–û–ò–¢–¨ –ü–ê–†–û–õ–¨–ù–£–Æ –ü–û–õ–ò–¢–ò–ö–£**

**–ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞:**

```bash
ipa pwpolicy-mod \
  --minlength=10 \
  --minclasses=3 \
  --history=4 \
  --maxlife=31 \
  --lockouttime=900 \
  --maxfail=3

```

**–ß–¢–û –≠–¢–û:**

- `-minlength=10` ‚Üí –º–∏–Ω–∏–º—É–º 10 —Å–∏–º–≤–æ–ª–æ–≤
- `-minclasses=3` ‚Üí 3 –∫–ª–∞—Å—Å–∞ —Å–∏–º–≤–æ–ª–æ–≤ (–∑–∞–≥–ª–∞–≤–Ω—ã–µ, —Ü–∏—Ñ—Ä—ã, —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã)
- `-history=4` ‚Üí –ø–æ–º–Ω–∏—Ç—å 4 —Å—Ç–∞—Ä—ã—Ö –ø–∞—Ä–æ–ª—è
- `-maxlife=31` ‚Üí —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è 31 –¥–µ–Ω—å
- `-lockouttime=900` ‚Üí –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –Ω–∞ 15 –º–∏–Ω—É—Ç (900 —Å–µ–∫—É–Ω–¥)
- `-maxfail=3` ‚Üí 3 –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–∫–∏

```bash
ipa pwpolicy-show
```

## **–®–ê–ì 6: –°–û–ó–î–ê–¢–¨ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø PETYA**

```bash
echo -e "Pa\$\$w0rd2026-2027\nPa\$\$w0rd2026-2027" | ipa user-add petya --first=Petya --last=Petrov --email=petya@reaskills.cyber --password

ipa user-mod petya --principal-expiration=20260515000000Z
```

```bash
ipa user-show petya
```

## **–®–ê–ì 7: –ù–ê–°–¢–†–û–ò–¢–¨ BACKUP LDAP**

**–°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç backup:**

```bash
sudo nano /usr/local/bin/freeipa-backup.sh
```

**–í–°–¢–ê–í–¨:**

```bash
#!/bin/bash

DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_FILE="/mnt/backup-user.backup"
PASSWORD="BackupPa\$\$"

ldapsearch -x -D "cn=Directory Manager" -w "$(cat /root/dm_password)" -b "dc=reaskills,dc=cyber" -LLL > /tmp/ldap_$DATE.ldif
tar -czf /tmp/ldap_$DATE.tar.gz /tmp/ldap_$DATE.ldif
openssl enc -aes-256-cbc -salt -pbkdf2 -in /tmp/ldap_$DATE.tar.gz -out $BACKUP_FILE -pass pass:"$PASSWORD"
rm -f /tmp/ldap_$DATE.ldif /tmp/ldap_$DATE.tar.gz

```

---

**–°–î–ï–õ–ê–¢–¨ –ò–°–ü–û–õ–ù–Ø–ï–ú–´–ú:**

```bash
sudo chmod +x /usr/local/bin/freeipa-backup.sh
```

---

**–ù–ê–°–¢–†–û–ò–¢–¨ –ï–ñ–ï–î–ù–ï–í–ù–´–ô –ó–ê–ü–£–°–ö (cron):**

```bash
sudo crontab -e
```

**–î–û–ë–ê–í–¨ –°–¢–†–û–ö–£:**

```bash
0 2 * * * /usr/local/bin/freeipa-backup.sh
```

**–ß–¢–û –≠–¢–û:** –ó–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 2:00 –Ω–æ—á–∏

```bash
sudo /usr/local/bin/freeipa-backup.sh
```

```bash
nano ~/backup-restore-instructions.txt
```

**–í–°–¢–ê–í–¨:**

```bash
=== –ö–ê–ö –í–û–°–°–¢–ê–ù–û–í–ò–¢–¨ BACKUP ===

1. –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å –∞—Ä—Ö–∏–≤:
   openssl enc -aes-256-cbc -d -in /mnt/backup-user.backup -out backup.tar.gz -k "BackupPa$$"

2. –†–∞—Å–ø–∞–∫–æ–≤–∞—Ç—å:
   tar -xzf backup.tar.gz

3. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å:
   ipa-restore --data --online ipa-backup-YYYYMMDD

–ü–∞—Ä–æ–ª—å –∞—Ä—Ö–∏–≤–∞: BackupPa$$
```

## **–®–ê–ì 8: –î–û–ë–ê–í–ò–¢–¨ PC1 –í –î–û–ú–ï–ù**

**–ù–∞ MAIN-DC1 (FreeIPA —Å–µ—Ä–≤–µ—Ä):**

**–ù–∏—á–µ–≥–æ –Ω–µ –Ω—É–∂–Ω–æ ‚Äî —Å–µ—Ä–≤–µ—Ä —É–∂–µ –≥–æ—Ç–æ–≤.**

**–ù–∞ PC1 (–∫–ª–∏–µ–Ω—Ç):**

```bash
# –ù–∞ PC1
apt install -y freeipa-client

ipa-client-install \
  --domain=reaskills.cyber \
  --realm=REASKILLS.CYBER \
  --server=main-dc1.reaskills.cyber \
  --mkhomedir \
  --enable-dns-updates \
  --unattended \
  --principal=admin \
  --password='P@ssw0rd'
```

**–ö–û–ì–î–ê –°–ü–†–û–°–ò–¢:**

- Principal: `admin`
- Password: `<admin –ø–∞—Ä–æ–ª—å>`

```bash
# –ù–∞ PC1 –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –≤–æ–π—Ç–∏
realm list
su - user1
```

`P@ssw0rdAdmin`

## **–®–ê–ì 9: –ù–ê–°–¢–†–û–ò–¢–¨ XRDP (–£–î–ê–õ–Å–ù–ù–´–ô –†–ê–ë–û–ß–ò–ô –°–¢–û–õ)**

**–ù–∞ PC1:**

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å XRDP
sudo apt install -y xrdp

# –†–∞–∑—Ä–µ—à–∏—Ç—å –≥—Ä—É–ø–ø–µ Administrators
sudo nano /etc/security/access.conf
```

**–î–û–ë–ê–í–¨:**

```bash
+:@Administrators:ALL
+:@worker:LOCAL
-:ALL:ALL
```

---

### **–õ–û–ì–ò–†–û–í–ê–ù–ò–ï XRDP –ù–ê MAIN-DC1:**

**–ù–∞ PC1:**

```bash
sudo nano /etc/rsyslog.d/xrdp.conf
```

**–í–°–¢–ê–í–¨:**

```bash
if $programname == 'xrdp' or $programname == 'xrdp-sesman' then @@192.168.1.10:514& stop
```

**–ù–∞ MAIN-DC1:**

```bash
sudo nano /etc/rsyslog.conf
```

**–†–ê–°–ö–û–ú–ú–ï–ù–¢–ò–†–£–ô:**

```bash
module(load="imudp")
input(type="imudp" port="514")

–ò–õ–ò

sed -i 's/#module(load="imudp")/module(load="imudp")/' /etc/rsyslog.conf
sed -i 's/#input(type="imudp" port="514")/input(type="imudp" port="514")/' /etc/rsyslog.conf

cat > /etc/rsyslog.d/xrdp-remote.conf << 'EOF'
:programname, isequal, "xrdp" /var/log/xrdp_audit.log
:programname, isequal, "xrdp-sesman" /var/log/xrdp_audit.log
& stop
EOF

systemctl restart rsyslog
touch /var/log/xrdp_audit.log
chmod 644 /var/log/xrdp_audit.log
```

**–ü–ï–†–ï–ó–ê–ü–£–°–ö:**

```bash
sudo systemctl restart rsyslog
```

## **–®–ê–ì 10: –§–ò–ù–ê–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê**

**–ß–ï–ö–õ–ò–°–¢ –ü–†–û–í–ï–†–ö–ò:**

```bash
# 1. –î–æ–º–µ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç
ipa realm

# 2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å–æ–∑–¥–∞–Ω–æ 71
ipa user-find | grep "User login" | wc -l

# 3. –ì—Ä—É–ø–ø—ã —Å–æ–∑–¥–∞–Ω—ã
ipa group-find | grep "Group name"

# 4. –ü–∞—Ä–æ–ª—å–Ω–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞
ipa pwpolicy-show

# 5. Petya —Å–æ–∑–¥–∞–Ω —Å –∏—Å—Ç–µ—á–µ–Ω–∏–µ–º
ipa user-show petya | grep expiration

# 6. Backup —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
ls -lh /mnt/backup-user.backup

# 7. PC1 –≤ –¥–æ–º–µ–Ω–µ
# –ù–∞ PC1:
realm list
```

---

## **üìù –®–ü–ê–†–ì–ê–õ–ö–ê (–î–õ–Ø –ß–ï–ú–ü–ò–û–ù–ê–¢–ê)**

**–ë–´–°–¢–†–´–ï –ö–û–ú–ê–ù–î–´:**

```bash
# –í–æ–π—Ç–∏ –∫–∞–∫ admin
kinit admin

# –°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—É
ipa group-add –ò–ú–Ø

# –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
echo "–ü–ê–†–û–õ–¨" | ipa user-add –õ–û–ì–ò–ù --first=–ò–ú–Ø --last=–§–ê–ú–ò–õ–ò–Ø --password

# –î–æ–±–∞–≤–∏—Ç—å –≤ –≥—Ä—É–ø–ø—É
ipa group-add-member –ì–†–£–ü–ü–ê --users=–õ–û–ì–ò–ù

# –ü–∞—Ä–æ–ª—å–Ω–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞
ipa pwpolicy-mod --minlength=10 --history=4 --maxlife=31

# Backup
ipa-backup --data --online -d /tmp/backup

# –î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞
sudo ipa-client-install --domain=reaskills.cyber
```