# OSPF (ДИНАМИЧЕСКАЯ МАРШРУТИЗАЦИЯ)

```bash
COD-RTR знает: 10.10.10.0/24, 10.10.20.0/24
MAIN-RTR знает: 192.168.1.0/24, 192.168.2.0/24, 192.168.3.0/24

❌ Они НЕ ЗНАЮТ о сетях друг друга
❌ Пакеты не идут между сетями
```

```bash
COD-RTR говорит MAIN-RTR: "У меня есть 10.10.10.0 и 10.10.20.0"
MAIN-RTR говорит COD-RTR: "У меня есть 192.168.1.0, 192.168.2.0, 192.168.3.0"

✅ Теперь они знают все сети
✅ Пакеты идут между ЦОД и Офисом
```

## **КАК НАСТРОИТЬ OSPF?**

**Установить FRRouting (программа для OSPF):**

```bash
apt update
apt install -y frr
```

**Включить OSPF в настройках:**

```bash
nano /etc/frr/daemons
```

**НАЙДИ И ИЗМЕНИ:**

```bash
ospfd=yes
```

**Настроить OSPF:**

```bash
vtysh
```

**ЭТО ОТКРОЕТ КОНСОЛЬ FRR. ВВОДИ КОМАНДЫ:**

```bash
configure terminal

router ospf
  ospf router-id 1.1.1.1
  network 10.8.0.0/24 area 0
  network 10.10.10.0/24 area 0
  network 10.10.20.0/24 area 0
  exit

interface tun0
  ip ospf authentication message-digest
  ip ospf message-digest-key 1 md5 secret_key
  exit

exit
write memory
exit
```

**ЧТО ЭТО ЗНАЧИТ:**

- `router-id 1.1.1.1` → уникальный ID роутера
- `network 10.8.0.0/24 area 0` → анонсировать эту сеть в OSPF
- `authentication message-digest` → защита паролем
- `md5 secret_key` → пароль для OSPF

**Перезапустить:**

```bash
systemctl restart frr
```

**Проверить, что работает:**

```bash
vtysh -c "show ip ospf neighbor"
```

# **МОНИТОРИНГ OSPF**

**ЗАДАЧА:**

Логировать изменения маршрутов в `/var/log/router_change.log` и уведомлять в активные сессии.

---

**Создать скрипт мониторинга:**

```bash
# На COD-RTR и MAIN-RTR
nano /usr/local/bin/ospf-monitor.sh
```

**Вставь:**

```bash
#!/bin/bash

LOGFILE="/var/log/router_change.log"
PREV_ROUTES="/tmp/ospf_routes_prev"
CURR_ROUTES="/tmp/ospf_routes_curr"

vtysh -c "show ip route ospf" > $CURR_ROUTES

if [ -f $PREV_ROUTES ]; then
  if ! diff -q $PREV_ROUTES $CURR_ROUTES > /dev/null; then
    echo "$(date): OSPF routes changed" >> $LOGFILE
    diff $PREV_ROUTES $CURR_ROUTES >> $LOGFILE
    wall "OSPF routes have changed! Check $LOGFILE"
  fi
fi

cp $CURR_ROUTES $PREV_ROUTES
```

**Сделать исполняемым:**

```bash
chmod +x /usr/local/bin/ospf-monitor.sh
```

**Добавить в cron (каждую минуту):**

```bash
crontab -e
```

**Добавь:**

```bash
* * * * * /usr/local/bin/ospf-monitor.sh
```