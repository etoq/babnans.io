<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì–∞–π–¥ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã - –ú–æ–¥—É–ª—å B</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            color: #e0e0e0;
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(30, 30, 45, 0.95);
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            padding: 40px;
            backdrop-filter: blur(10px);
        }

        h1 {
            color: #00d4ff;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
            text-shadow: 0 0 20px rgba(0, 212, 255, 0.5);
        }

        .subtitle {
            text-align: center;
            color: #888;
            margin-bottom: 40px;
            font-size: 1.1em;
        }

        h2 {
            color: #ff6b6b;
            margin: 30px 0 15px 0;
            padding-bottom: 10px;
            border-bottom: 2px solid #ff6b6b;
            font-size: 1.8em;
        }

        h3 {
            color: #4ecdc4;
            margin: 25px 0 10px 0;
            font-size: 1.4em;
        }

        h4 {
            color: #ffe66d;
            margin: 20px 0 10px 0;
            font-size: 1.2em;
        }

        p {
            margin: 10px 0;
            color: #c0c0c0;
        }

        code {
            background: #1a1a2e;
            color: #00ff41;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        pre {
            background: #0d1117;
            border: 1px solid #30363d;
            border-left: 4px solid #00d4ff;
            border-radius: 6px;
            padding: 15px;
            overflow-x: auto;
            margin: 15px 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        pre code {
            background: none;
            padding: 0;
            color: #c9d1d9;
            display: block;
            font-size: 0.95em;
            line-height: 1.5;
        }

        ul, ol {
            margin: 15px 0 15px 30px;
            color: #c0c0c0;
        }

        li {
            margin: 8px 0;
            padding-left: 5px;
        }

        .checklist {
            background: rgba(46, 213, 115, 0.1);
            border-left: 4px solid #2ed573;
            padding: 20px;
            margin: 20px 0;
            border-radius: 6px;
        }

        .checklist li {
            list-style-type: none;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .checklist li:last-child {
            border-bottom: none;
        }

        .checklist li:before {
            content: "‚òê ";
            color: #2ed573;
            font-weight: bold;
            margin-right: 10px;
            font-size: 1.2em;
        }

        .warning {
            background: rgba(255, 107, 107, 0.15);
            border-left: 4px solid #ff6b6b;
            padding: 15px;
            margin: 20px 0;
            border-radius: 6px;
        }

        .info {
            background: rgba(0, 212, 255, 0.15);
            border-left: 4px solid #00d4ff;
            padding: 15px;
            margin: 20px 0;
            border-radius: 6px;
        }

        .success {
            background: rgba(46, 213, 115, 0.15);
            border-left: 4px solid #2ed573;
            padding: 15px;
            margin: 20px 0;
            border-radius: 6px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: rgba(20, 20, 35, 0.8);
            border-radius: 8px;
            overflow: hidden;
        }

        th {
            background: rgba(0, 212, 255, 0.2);
            color: #00d4ff;
            padding: 12px;
            text-align: left;
            font-weight: bold;
        }

        td {
            padding: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .nav {
            background: rgba(20, 20, 35, 0.95);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            border: 1px solid rgba(0, 212, 255, 0.3);
        }

        .nav h3 {
            color: #00d4ff;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .nav ul {
            list-style: none;
            margin: 0;
        }

        .nav li {
            margin: 8px 0;
        }

        .nav a {
            color: #4ecdc4;
            text-decoration: none;
            transition: all 0.3s ease;
            display: block;
            padding: 5px 10px;
            border-radius: 5px;
        }

        .nav a:hover {
            background: rgba(78, 205, 196, 0.2);
            padding-left: 15px;
            color: #00d4ff;
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: bold;
            margin-left: 10px;
        }

        .badge-debian {
            background: rgba(215, 10, 83, 0.3);
            color: #ff6b9d;
        }

        .badge-astra {
            background: rgba(78, 205, 196, 0.3);
            color: #4ecdc4;
        }

        .badge-important {
            background: rgba(255, 107, 107, 0.3);
            color: #ff6b6b;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            h1 {
                font-size: 1.8em;
            }

            h2 {
                font-size: 1.4em;
            }

            pre {
                font-size: 0.85em;
            }
        }

        .scroll-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: rgba(0, 212, 255, 0.8);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 212, 255, 0.4);
        }

        .scroll-top:hover {
            background: rgba(0, 212, 255, 1);
            transform: translateY(-5px);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>–ü–û–õ–ù–´–ô –ì–ê–ô–î –ü–û –ù–ê–°–¢–†–û–ô–ö–ï –ò–ù–§–†–ê–°–¢–†–£–ö–¢–£–†–´</h1>
        <div class="subtitle">–ú–æ–¥—É–ª—å B - –ó–∞—â–∏—Ç–∞ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–π –ò–¢-–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã | REASkills 2026</div>

        <div class="info">
            <strong>üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ—Å—Ç—É–ø–∞—Ö:</strong><br>
            ‚Ä¢ Debian 12 —Ä–æ—É—Ç–µ—Ä—ã: <code>root:toor</code><br>
            ‚Ä¢ Astra Linux –º–∞—à–∏–Ω—ã: <code>astra:P@ssw0rd</code><br>
            ‚Ä¢ DNS —Å–µ—Ä–≤–µ—Ä: <code>77.88.8.1</code><br>
            ‚Ä¢ –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: <code>repo.external.ru</code>
        </div>

        <div class="nav">
            <h3>üìë –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ</h3>
            <ul>
                <li><a href="#part1">1. –ë–∞–∑–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ç–∏ –∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤</a></li>
                <li><a href="#part2">2. DNS –∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –Ω–∞ Astra Linux</a></li>
                <li><a href="#part3">3. SSH –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</a></li>
                <li><a href="#part4">4. VPN –º–µ–∂–¥—É —Ä–æ—É—Ç–µ—Ä–∞–º–∏</a></li>
                <li><a href="#part5">5. OSPF</a></li>
                <li><a href="#part6">6. PAT –∏ Firewall</a></li>
                <li><a href="#part7">7. FreeIPA</a></li>
                <li><a href="#part8">8. –ö–ª–∏–µ–Ω—Ç PC1</a></li>
                <li><a href="#part9">9. Storage —Å–µ—Ä–≤–µ—Ä—ã</a></li>
                <li><a href="#part10">10. COD-WEB</a></li>
                <li><a href="#part11">11. OpenVPN –¥–ª—è Remote Worker</a></li>
                <li><a href="#part12">12. COD-DOCKER</a></li>
                <li><a href="#part13">13. –ü—Ä–æ–≤–µ—Ä–∫–∞</a></li>
                <li><a href="#checklist">‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫</a></li>
            </ul>
        </div>

        <h2 id="part1">–ß–ê–°–¢–¨ 1: –ë–∞–∑–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ç–∏ –∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ <span class="badge badge-debian">Debian 12</span></h2>

        <h3>1.1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –Ω–∞ —Ä–æ—É—Ç–µ—Ä–∞—Ö</h3>
        <p>–ù–∞ <strong>COD-RTR</strong> –∏ <strong>MAIN-RTR</strong>:</p>
        <pre><code># –ù–∞—Å—Ç—Ä–æ–π–∫–∞ DNS
echo "nameserver 77.88.8.1" > /etc/resolv.conf

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
cat > /etc/apt/sources.list << EOF
deb http://repo.external.ru/debian bookworm main contrib non-free
deb http://repo.external.ru/debian-security bookworm-security main contrib non-free
deb http://repo.external.ru/debian bookworm-updates main contrib non-free
EOF

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ
apt update</code></pre>
        <div class="warning">
            <strong>‚ö†Ô∏è –í–ê–ñ–ù–û: –ï—Å–ª–∏ –±–∞–∑–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ù–ï –†–ê–ë–û–¢–ê–ï–¢!</strong><br>
            –ù–∏–∂–µ –í–°–ï –≤–æ–∑–º–æ–∂–Ω—ã–µ –º–µ—Ç–æ–¥—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ Debian 12.<br>
            –ü—Ä–æ–±—É–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –¥–æ —É—Å–ø–µ—Ö–∞!
        </div>

        <h3>üîπ –ú–ï–¢–û–î 2: DNS –Ω–µ —Ä–µ–∑–æ–ª–≤–∏—Ç repo.external.ru</h3>
        <pre><code># –£–∑–Ω–∞–π IP –∞–¥—Ä–µ—Å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è (—Å–ø—Ä–æ—Å–∏ —É –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–æ–≤)
# –ù–∞–ø—Ä–∏–º–µ—Ä: 192.168.100.10

# –î–æ–±–∞–≤—å –≤ /etc/hosts
echo "192.168.100.10 repo.external.ru" >> /etc/hosts

# –ü—Ä–æ–≤–µ—Ä–∫–∞
ping -c 2 repo.external.ru

apt update</code></pre>

        <h3>üîπ –ú–ï–¢–û–î 3: –ó–∞—â–∏—Ç–∞ /etc/resolv.conf</h3>
        <pre><code># –ò–Ω–æ–≥–¥–∞ NetworkManager –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç DNS
chattr +i /etc/resolv.conf

# –ü—Ä–æ–≤–µ—Ä–∫–∞
lsattr /etc/resolv.conf

apt update</code></pre>

        <h3>üîπ –ú–ï–¢–û–î 4: –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –∑–µ—Ä–∫–∞–ª–∞ Debian</h3>
        <pre><code>cat > /etc/apt/sources.list << 'EOF'
deb http://deb.debian.org/debian bookworm main contrib non-free non-free-firmware
deb http://deb.debian.org/debian bookworm-updates main contrib non-free non-free-firmware
deb http://security.debian.org/debian-security bookworm-security main contrib non-free non-free-firmware
EOF

apt clean
apt update</code></pre>

        <h3>üîπ –ú–ï–¢–û–î 5: –†–æ—Å—Å–∏–π—Å–∫–∏–µ –∑–µ—Ä–∫–∞–ª–∞</h3>
        <pre><code>cat > /etc/apt/sources.list << 'EOF'
deb http://mirror.yandex.ru/debian bookworm main contrib non-free non-free-firmware
deb http://mirror.yandex.ru/debian bookworm-updates main contrib non-free non-free-firmware
deb http://mirror.yandex.ru/debian-security bookworm-security main contrib non-free non-free-firmware
EOF

apt update</code></pre>

        <h3>üîπ –ú–ï–¢–û–î 6: –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ GPG –æ—à–∏–±–æ–∫</h3>
        <pre><code># –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ NO_PUBKEY
apt-get update --allow-insecure-repositories
apt-get install -y curl --allow-unauthenticated</code></pre>

        <h3>üîπ –ú–ï–¢–û–î 7: –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞</h3>
        <pre><code>apt clean
rm -rf /var/lib/apt/lists/*
mkdir -p /var/lib/apt/lists/partial
apt update</code></pre>

        <h3>üîπ –ú–ï–¢–û–î 8: –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Ç–∞–π–º–∞—É—Ç–∞</h3>
        <pre><code>apt-get -o Acquire::http::Timeout=120 -o Acquire::Retries=10 update</code></pre>

        <div class="success">
            <strong>‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞:</strong>
            <pre><code>apt update
apt install -y curl
curl --version</code></pre>
        </div>


        <h3>1.2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –ø–æ —Ç–æ–ø–æ–ª–æ–≥–∏–∏</h3>

        <h4>COD-RTR (Debian 12):</h4>
        <pre><code># /etc/network/interfaces
auto lo
iface lo inet loopback

# –ö CI-CD —Å–µ—Ç–∏
auto ens18
iface ens18 inet static
    address 10.10.10.0/24

# –ö WEB-DOCKER —Å–µ—Ç–∏
auto ens19
iface ens19 inet static
    address 10.10.20.0/24

# –ö ISP (–≤–Ω–µ—à–Ω–∏–π)
auto ens20
iface ens20 inet static
    address 152.32.66.0/30

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ç–∏
systemctl restart networking</code></pre>

        <h4>MAIN-RTR (Debian 12):</h4>
        <pre><code># /etc/network/interfaces
auto lo
iface lo inet loopback

# –ö ISP
auto ens18
iface ens18 inet static
    address 100.200.100.0/30

# –ö DC1 —Å–µ—Ç–∏
auto ens19
iface ens19 inet static
    address 192.168.1.0/24

# –ö STORAGE —Å–µ—Ç–∏
auto ens20
iface ens20 inet static
    address 192.168.2.0/24

# –ö CLI —Å–µ—Ç–∏
auto ens21
iface ens21 inet static
    address 192.168.3.0/24

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
systemctl restart networking</code></pre>

        <h3>1.3. –í–∫–ª—é—á–µ–Ω–∏–µ IP forwarding –Ω–∞ —Ä–æ—É—Ç–µ—Ä–∞—Ö</h3>
        <pre><code># –ù–∞ –æ–±–æ–∏—Ö —Ä–æ—É—Ç–µ—Ä–∞—Ö
echo "net.ipv4.ip_forward=1" >> /etc/sysctl.conf
sysctl -p</code></pre>

        <h2 id="part2">–ß–ê–°–¢–¨ 2: DNS –∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –Ω–∞ Astra Linux <span class="badge badge-astra">Astra Linux</span></h2>

        <p>–ù–∞ –≤—Å–µ—Ö –º–∞—à–∏–Ω–∞—Ö Astra Linux:</p>
        <pre><code>su -
# –ü–∞—Ä–æ–ª—å: P@ssw0rd

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ DNS
echo "nameserver 77.88.8.1" > /etc/resolv.conf

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –¥–ª—è Astra Linux
cat > /etc/apt/sources.list << EOF
deb http://repo.external.ru/astra smolensk main contrib non-free
EOF

apt update</code></pre>
        <div class="warning">
            <strong>‚ö†Ô∏è –í–ê–ñ–ù–û: –î–ª—è Astra Linux - –í–°–ï –º–µ—Ç–æ–¥—ã!</strong><br>
            Astra –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Ä–∞–∑–Ω—ã–µ –≤–µ—Ä—Å–∏–∏. –ü—Ä–æ–±—É–π –≤—Å–µ –º–µ—Ç–æ–¥—ã!
        </div>

        <h3>üîπ –ú–ï–¢–û–î 2: –î–ª—è Astra Linux Orel</h3>
        <pre><code>su -
# –ü—Ä–æ–≤–µ—Ä—å –≤–µ—Ä—Å–∏—é
cat /etc/astra_version

# –î–ª—è Orel:
cat > /etc/apt/sources.list << EOF
deb http://repo.external.ru/astra orel main contrib non-free
EOF

apt update</code></pre>

        <h3>üîπ –ú–ï–¢–û–î 3: –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π Astra</h3>
        <pre><code>cat > /etc/apt/sources.list << EOF
deb http://dl.astralinux.ru/astra/stable/smolensk/repository smolensk main contrib non-free
EOF

apt update</code></pre>

        <h3>üîπ –ú–ï–¢–û–î 4: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CD/ISO</h3>
        <pre><code># –ú–æ–Ω—Ç–∏—Ä—É–π ISO
mount /dev/sr0 /media/cdrom

cat > /etc/apt/sources.list << EOF
deb file:///media/cdrom/ smolensk main contrib non-free
EOF

apt update</code></pre>

        <h3>üîπ –ú–ï–¢–û–î 5: Debian-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏</h3>
        <pre><code># Astra –æ—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞ Debian 10 (Buster)
cat > /etc/apt/sources.list << EOF
deb http://deb.debian.org/debian buster main contrib non-free
EOF

apt update --allow-insecure-repositories</code></pre>

        <h3>üîπ –ú–ï–¢–û–î 6: –ó–∞—â–∏—Ç–∞ resolv.conf</h3>
        <pre><code>chattr +i /etc/resolv.conf

# –û—Ç–∫–ª—é—á–∏ NetworkManager –µ—Å–ª–∏ –º–µ—à–∞–µ—Ç
systemctl stop NetworkManager
systemctl disable NetworkManager

apt update</code></pre>

        <h3>üîπ –ú–ï–¢–û–î 7: –ß–µ—Ä–µ–∑ /etc/hosts</h3>
        <pre><code># –î–æ–±–∞–≤—å IP —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
echo "192.168.100.10 repo.external.ru" >> /etc/hosts
echo "192.168.100.10 dl.astralinux.ru" >> /etc/hosts

apt update</code></pre>

        <h3>üîπ –ú–ï–¢–û–î 8: –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ GPG</h3>
        <pre><code>apt-get update --allow-insecure-repositories
apt-get install -y mc --allow-unauthenticated</code></pre>

        <div class="success">
            <strong>‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞:</strong>
            <pre><code>apt update
apt install -y mc
mc --version</code></pre>
        </div>


        <h2 id="part3">–ß–ê–°–¢–¨ 3: SSH –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å <span class="badge badge-important">–ö—Ä–∏—Ç–∏—á–Ω–æ</span></h2>

        <h3>3.1. –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è sshuser</h3>
        <pre><code># –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –≤—Å–µ—Ö –º–∞—à–∏–Ω–∞—Ö
useradd -m -s /bin/bash sshuser
echo "sshuser:P@ssw0rd" | chpasswd</code></pre>

        <h3>3.2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSH</h3>
        <pre><code># –£—Å—Ç–∞–Ω–æ–≤–∫–∞ SSH (–µ—Å–ª–∏ –Ω–µ—Ç)
apt install -y openssh-server

# –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ /etc/ssh/sshd_config
cat >> /etc/ssh/sshd_config << EOF

# –†–∞–∑—Ä–µ—à–∏—Ç—å —Ç–æ–ª—å–∫–æ sshuser
AllowUsers sshuser
PermitRootLogin no
PasswordAuthentication yes
PubkeyAuthentication yes
EOF

systemctl restart sshd</code></pre>

        <h3>3.3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Fail2ban</h3>
        <pre><code>apt install -y fail2ban

# –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
cat > /etc/fail2ban/jail.local << EOF
[DEFAULT]
bantime = 1m
findtime = 10m
maxretry = 2

[sshd]
enabled = true
port = ssh
logpath = /var/log/auth.log
maxretry = 2
bantime = 1m
EOF

systemctl enable fail2ban
systemctl restart fail2ban</code></pre>

        <h3>3.4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ auditd –¥–ª—è SSH</h3>
        <pre><code>apt install -y auditd

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞
echo "-w /usr/sbin/sshd -p x -k ssh_connections" >> /etc/audit/rules.d/ssh.rules

service auditd restart</code></pre>

        <h2 id="part4">–ß–ê–°–¢–¨ 4: VPN –º–µ–∂–¥—É COD-RTR –∏ MAIN-RTR <span class="badge badge-debian">Debian 12</span></h2>

        <h3>4.1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ OpenVPN –Ω–∞ COD-RTR</h3>
        <pre><code>apt install -y openvpn easy-rsa iptables

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Easy-RSA
make-cadir /etc/openvpn/easy-rsa
cd /etc/openvpn/easy-rsa

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è PKI
./easyrsa init-pki
./easyrsa build-ca nopass  # –ù–∞–∂–∞—Ç—å Enter
./easyrsa gen-dh
./easyrsa build-server-full server nopass
./easyrsa build-client-full main-rtr nopass

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
cp pki/ca.crt /etc/openvpn/
cp pki/issued/server.crt /etc/openvpn/
cp pki/private/server.key /etc/openvpn/
cp pki/dh.pem /etc/openvpn/

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–µ—Ä–∞
cat > /etc/openvpn/server.conf << EOF
port 1194
proto udp
dev tun0
ca ca.crt
cert server.crt
key server.key
dh dh.pem
server 10.8.0.0 255.255.255.0
ifconfig-pool-persist ipp.txt
push "route 192.168.1.0 255.255.255.0"
push "route 192.168.2.0 255.255.255.0"
push "route 192.168.3.0 255.255.255.0"
keepalive 10 120
cipher AES-256-CBC
persist-key
persist-tun
status openvpn-status.log
verb 3
EOF

systemctl enable openvpn@server
systemctl start openvpn@server</code></pre>

        <h3>4.2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ OpenVPN –Ω–∞ MAIN-RTR</h3>
        <div class="warning">
            <strong>‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ:</strong> –ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã —Å COD-RTR —á–µ—Ä–µ–∑ scp –∏–ª–∏ –≤—Ä—É—á–Ω—É—é
        </div>
        <pre><code>apt install -y openvpn

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞
cat > /etc/openvpn/client.conf << EOF
client
dev tun0
proto udp
remote 152.32.66.0 1194
resolv-retry infinite
nobind
persist-key
persist-tun
ca ca.crt
cert main-rtr.crt
key main-rtr.key
cipher AES-256-CBC
verb 3
EOF

systemctl enable openvpn@client
systemctl start openvpn@client</code></pre>

        <h3>4.3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ Wireguard VPN</h3>

        <h4>–ù–∞ COD-RTR:</h4>
        <pre><code>apt install -y wireguard

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π
wg genkey | tee /etc/wireguard/server_private.key | wg pubkey > /etc/wireguard/server_public.key

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
cat > /etc/wireguard/wg0.conf << EOF
[Interface]
Address = 10.9.0.1/24
ListenPort = 51820
PrivateKey = $(cat /etc/wireguard/server_private.key)

[Peer]
PublicKey = MAIN_RTR_PUBLIC_KEY_–ó–î–ï–°–¨
AllowedIPs = 10.9.0.2/32, 192.168.0.0/16
EOF

systemctl enable wg-quick@wg0</code></pre>

        <h4>–ù–∞ MAIN-RTR:</h4>
        <pre><code>apt install -y wireguard

wg genkey | tee /etc/wireguard/client_private.key | wg pubkey > /etc/wireguard/client_public.key

cat > /etc/wireguard/wg0.conf << EOF
[Interface]
Address = 10.9.0.2/24
PrivateKey = $(cat /etc/wireguard/client_private.key)

[Peer]
PublicKey = COD_RTR_PUBLIC_KEY_–ó–î–ï–°–¨
Endpoint = 152.32.66.0:51820
AllowedIPs = 10.9.0.0/24, 10.10.0.0/16
PersistentKeepalive = 25
EOF

systemctl enable wg-quick@wg0</code></pre>

        <h2 id="part5">–ß–ê–°–¢–¨ 5: OSPF <span class="badge badge-debian">Debian 12</span></h2>

        <h3>5.1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ FRRouting</h3>
        <pre><code># –ù–∞ –æ–±–æ–∏—Ö —Ä–æ—É—Ç–µ—Ä–∞—Ö
apt install -y frr

# –í–∫–ª—é—á–µ–Ω–∏–µ OSPF
sed -i 's/ospfd=no/ospfd=yes/' /etc/frr/daemons
systemctl restart frr</code></pre>

        <h3>5.2. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è OSPF –Ω–∞ COD-RTR</h3>
        <pre><code>vtysh

configure terminal
router ospf
 ospf router-id 1.1.1.1
 network 10.8.0.0/24 area 0
 network 10.10.10.0/24 area 0
 network 10.10.20.0/24 area 0
 area 0 authentication message-digest
exit

interface tun0
 ip ospf message-digest-key 1 md5 SecretKey123
 ip ospf hello-interval 10
exit

exit
write memory</code></pre>

        <h3>5.3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è OSPF –Ω–∞ MAIN-RTR</h3>
        <pre><code>vtysh

configure terminal
router ospf
 ospf router-id 2.2.2.2
 network 10.8.0.0/24 area 0
 network 192.168.1.0/24 area 0
 network 192.168.2.0/24 area 0
 network 192.168.3.0/24 area 0
 area 0 authentication message-digest
exit

interface tun0
 ip ospf message-digest-key 1 md5 SecretKey123
 ip ospf hello-interval 10
exit

exit
write memory</code></pre>

        <h3>5.4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏–∑–º–µ–Ω–µ–Ω–∏–π –º–∞—Ä—à—Ä—É—Ç–æ–≤</h3>
        <pre><code># –ù–∞ –æ–±–æ–∏—Ö —Ä–æ—É—Ç–µ—Ä–∞—Ö
cat > /usr/local/bin/ospf-monitor.sh << 'EOF'
#!/bin/bash
vtysh -c "show ip route" | logger -t OSPF-MONITOR
wall "OSPF routes changed! Check /var/log/router_change.log"
EOF

chmod +x /usr/local/bin/ospf-monitor.sh

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
echo "local7.* /var/log/router_change.log" >> /etc/rsyslog.conf
systemctl restart rsyslog

# –î–æ–±–∞–≤–∏—Ç—å –≤ cron –¥–ª—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
echo "*/5 * * * * /usr/local/bin/ospf-monitor.sh" | crontab -</code></pre>

        <h2 id="part6">–ß–ê–°–¢–¨ 6: PAT (NAT) –∏ Firewall —Å nftables <span class="badge badge-debian">Debian 12</span></h2>

        <h3>6.1. –ù–∞ COD-RTR</h3>
        <pre><code>apt install -y nftables

cat > /etc/nftables.conf << 'EOF'
#!/usr/sbin/nft -f

flush ruleset

table inet filter {
    chain input {
        type filter hook input priority 0; policy drop;
        ct state established,related accept
        iif "lo" accept
        tcp dport 22 accept
        tcp dport 1194 accept
        udp dport 51820 accept
    }

    chain forward {
        type filter hook forward priority 0; policy drop;
        ct state established,related accept
        iifname "tun0" accept
        oifname "tun0" accept
    }

    chain output {
        type filter hook output priority 0; policy accept;
    }
}

table ip nat {
    chain postrouting {
        type nat hook postrouting priority 100; policy accept;
        oifname "ens20" masquerade
    }
}

table inet rate_limit {
    chain input {
        type filter hook input priority -10; policy accept;
        iifname "ens20" limit rate over 100/second drop
    }
}
EOF

systemctl enable nftables
systemctl restart nftables</code></pre>

        <h3>6.2. –ù–∞ MAIN-RTR</h3>
        <pre><code>apt install -y nftables

cat > /etc/nftables.conf << 'EOF'
#!/usr/sbin/nft -f

flush ruleset

table inet filter {
    chain input {
        type filter hook input priority 0; policy drop;
        ct state established,related accept
        iif "lo" accept
        tcp dport 22 accept
    }

    chain forward {
        type filter hook forward priority 0; policy drop;
        ct state established,related accept
        iifname "tun0" accept
        oifname "tun0" accept
        iifname "ens19" accept
        iifname "ens20" accept
        iifname "ens21" accept
    }

    chain output {
        type filter hook output priority 0; policy accept;
    }
}

table ip nat {
    chain postrouting {
        type nat hook postrouting priority 100; policy accept;
        oifname "ens18" masquerade
    }
}

table inet rate_limit {
    chain input {
        type filter hook input priority -10; policy accept;
        iifname "ens18" limit rate over 100/second drop
    }
}
EOF

systemctl enable nftables
systemctl restart nftables</code></pre>

        <h2 id="part7">–ß–ê–°–¢–¨ 7: FreeIPA –Ω–∞ MAIN-DC1 <span class="badge badge-astra">Astra Linux</span></h2>

        <h3>7.1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ FreeIPA Server</h3>
        <pre><code>su -

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ FreeIPA
apt install -y freeipa-server freeipa-server-dns

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ hostname
hostnamectl set-hostname dc1.reaskills.cyber
echo "192.168.1.10 dc1.reaskills.cyber dc1" >> /etc/hosts

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ FreeIPA
ipa-server-install \
  --realm REASKILLS.CYBER \
  --domain reaskills.cyber \
  --ds-password P@ssw0rdDS \
  --admin-password P@ssw0rdAdmin \
  --hostname dc1.reaskills.cyber \
  --no-ntp \
  --setup-dns \
  --forwarder 77.88.8.1 \
  --unattended</code></pre>

        <h3>7.2. –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –≥—Ä—É–ø–ø</h3>
        <pre><code># –ü–æ–ª—É—á–µ–Ω–∏–µ Kerberos ticket
kinit admin
# –ü–∞—Ä–æ–ª—å: P@ssw0rdAdmin

# –°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä—É–ø–ø
ipa group-add Administrators --desc="Administrators Group"
ipa group-add Worker --desc="Worker Group"
ipa group-add TopManager --desc="Top Manager Group"

# –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π User1-40
for i in {1..40}; do
  ipa user-add User$i --first=User --last=$i --password --password-expiration=2026-12-31
  echo "P@ssw0rdAdmin" | ipa user-mod User$i --password
  ipa group-add-member Administrators --users=User$i
done

# –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π User41-80
for i in {41..80}; do
  ipa user-add User$i --first=User --last=$i --password
  echo "P@ssw0rdWorker" | ipa user-mod User$i --password
  ipa group-add-member Worker --users=User$i
done

# –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π SuperUser100-130
for i in {100..130}; do
  ipa user-add SuperUser$i --first=SuperUser --last=$i --password
  echo "P@ssw0rdTop" | ipa user-mod SuperUser$i --password
  ipa group-add-member TopManager --users=SuperUser$i
done

# –°–æ–∑–¥–∞–Ω–∏–µ Petya
ipa user-add Petya --first=Petya --last=Ivanov --password --principal-expiration=20260515000000Z
echo "Pa\$\$w0rd2026-2027" | ipa user-mod Petya --password</code></pre>

        <h3>7.3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–æ–ª—å–Ω–æ–π –ø–æ–ª–∏—Ç–∏–∫–∏</h3>
        <pre><code>ipa pwpolicy-mod \
  --minlength=10 \
  --history=4 \
  --maxlife=31 \
  --minclasses=3 \
  --lockouttime=900 \
  --maxfail=3</code></pre>

        <h3>7.4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è LDAP</h3>
        <pre><code>mkdir -p /mnt/backup-user

cat > /usr/local/bin/backup-ldap.sh << 'EOF'
#!/bin/bash
BACKUP_DIR="/mnt/backup-user"
DATE=$(date +%Y%m%d)
LDIF_FILE="$BACKUP_DIR/backup-$DATE.ldif"

# –≠–∫—Å–ø–æ—Ä—Ç LDAP
ldapsearch -x -LLL -b "dc=reaskills,dc=cyber" > "$LDIF_FILE"

# –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ–º
cd $BACKUP_DIR
tar czf backup-$DATE.tar.gz backup-$DATE.ldif
openssl enc -aes-256-cbc -salt -in backup-$DATE.tar.gz -out backup-$DATE.backup -k "BackupPa$$"
rm backup-$DATE.ldif backup-$DATE.tar.gz

echo "Backup completed: $BACKUP_DIR/backup-$DATE.backup"
EOF

chmod +x /usr/local/bin/backup-ldap.sh

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ cron
echo "0 2 * * * /usr/local/bin/backup-ldap.sh" | crontab -

# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è —ç–∫—Å–ø–µ—Ä—Ç–æ–≤
cat > /root/BACKUP_INSTRUCTIONS.txt << 'EOF'
–î–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏:

1. –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å –∞—Ä—Ö–∏–≤:
   openssl enc -aes-256-cbc -d -in backup-YYYYMMDD.backup -out backup-YYYYMMDD.tar.gz -k "BackupPa$$"

2. –†–∞—Å–ø–∞–∫–æ–≤–∞—Ç—å:
   tar xzf backup-YYYYMMDD.tar.gz

3. –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ LDAP:
   ldapadd -x -D "cn=Directory Manager" -W -f backup-YYYYMMDD.ldif
EOF</code></pre>

        <h2 id="part8">–ß–ê–°–¢–¨ 8: PC1 - –ö–ª–∏–µ–Ω—Ç FreeIPA <span class="badge badge-astra">Astra Linux</span></h2>

        <h3>8.1. –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ –¥–æ–º–µ–Ω—É</h3>
        <pre><code>su -

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ FreeIPA –∫–ª–∏–µ–Ω—Ç–∞
apt install -y freeipa-client

# –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ –¥–æ–º–µ–Ω—É
ipa-client-install \
  --domain=reaskills.cyber \
  --realm=REASKILLS.CYBER \
  --server=dc1.reaskills.cyber \
  --principal=admin \
  --password=P@ssw0rdAdmin \
  --unattended</code></pre>

        <h3>8.2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ XRDP</h3>
        <pre><code>apt install -y xrdp xorgxrdp

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSSD –¥–ª—è —É—Ä–æ–≤–Ω–µ–π —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏
cat >> /etc/sssd/sssd.conf << 'EOF'

[domain/reaskills.cyber]
ldap_user_extra_attrs = astraLinuxIntegrity
ldap_user_integrity_level = astraLinuxIntegrity
EOF

systemctl restart sssd

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ PAM –¥–ª—è XRDP
cat > /etc/pam.d/xrdp-sesman << 'EOF'
auth    required   pam_sepermit.so
auth    required   pam_unix.so
auth    required   pam_sss.so
account required   pam_unix.so
account required   pam_sss.so
password required  pam_unix.so
session required   pam_unix.so
session required   pam_sss.so
session required   pam_mkhomedir.so
EOF

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è NFS
echo "192.168.2.10:/data /mnt/homes nfs defaults 0 0" >> /etc/fstab
mkdir -p /mnt/homes
mount -a

systemctl enable xrdp
systemctl start xrdp</code></pre>

        <h3>8.3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è XRDP</h3>
        <h4>–ù–∞ PC1:</h4>
        <pre><code>apt install -y rsyslog

cat >> /etc/rsyslog.conf << 'EOF'
# Forward XRDP logs to MAIN-DC1
if $programname == 'xrdp' then @@192.168.1.10:514
& stop
EOF

systemctl restart rsyslog</code></pre>

        <h4>–ù–∞ MAIN-DC1:</h4>
        <pre><code>cat >> /etc/rsyslog.conf << 'EOF'
# Enable UDP/TCP syslog reception
module(load="imudp")
input(type="imudp" port="514")
module(load="imtcp")
input(type="imtcp" port="514")

# Template for XRDP logs
template(name="XRDPLog" type="string" string="/var/log/xrdp_audit.log")
if $programname == 'xrdp' then ?XRDPLog
& stop
EOF

systemctl restart rsyslog</code></pre>

        <h2 id="part9">–ß–ê–°–¢–¨ 9: Storage —Å–µ—Ä–≤–µ—Ä—ã <span class="badge badge-astra">Astra Linux</span></h2>

        <h3>9.1. MAIN-STORAGE1 (NFS —Å–µ—Ä–≤–µ—Ä)</h3>
        <pre><code>su -

apt install -y nfs-kernel-server

# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
mkdir -p /data
chmod 755 /data

# –≠–∫—Å–ø–æ—Ä—Ç NFS
cat >> /etc/exports << 'EOF'
/data 192.168.0.0/16(rw,sync,no_root_squash,no_subtree_check)
EOF

exportfs -a
systemctl enable nfs-kernel-server
systemctl restart nfs-kernel-server

# –°–∫—Ä–∏–ø—Ç —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
cat > /usr/local/bin/save_all.sh << 'EOF'
#!/bin/bash
rsync -avz --delete /data/ root@192.168.2.20:/data-backup/
logger "Backup completed to MAIN-STORAGE2"
EOF

chmod +x /usr/local/bin/save_all.sh

# Alias –¥–ª—è –∫–æ–º–∞–Ω–¥—ã save_all
echo "alias save_all='/usr/local/bin/save_all.sh'" >> /root/.bashrc

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ cron (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 3:00)
echo "0 3 * * * /usr/local/bin/save_all.sh" | crontab -</code></pre>

        <h3>9.2. MAIN-STORAGE2 (Web-—Å–µ—Ä–≤–µ—Ä)</h3>
        <pre><code>su -

mkdir -p /data-backup /data_saver

apt install -y apache2 libapache2-mod-authnz-external pwauth

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Apache
cat > /etc/apache2/sites-available/filesaver.conf << 'EOF'
<VirtualHost *:443>
    ServerName www.reaskills.cyber
    DocumentRoot /data_saver

    SSLEngine on
    SSLCertificateFile /etc/ssl/certs/reaskills.crt
    SSLCertificateKeyFile /etc/ssl/private/reaskills.key

    <Directory /data_saver>
        Options +Indexes +FollowSymLinks
        AllowOverride None
        AuthType Basic
        AuthName "Restricted Access"
        AuthBasicProvider ldap
        AuthLDAPURL "ldap://192.168.1.10/dc=reaskills,dc=cyber?uid?sub?(objectClass=*)"
        AuthLDAPBindDN "cn=Directory Manager,dc=reaskills,dc=cyber"
        AuthLDAPBindPassword "P@ssw0rdDS"
        Require ldap-group cn=TopManager,cn=groups,cn=accounts,dc=reaskills,dc=cyber
    </Directory>
</VirtualHost>
EOF

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
  -keyout /etc/ssl/private/reaskills.key \
  -out /etc/ssl/certs/reaskills.crt \
  -subj "/C=RU/ST=Moscow/L=Moscow/O=REASkills/CN=www.reaskills.cyber"

a2enmod ssl authnz_ldap
a2ensite filesaver
systemctl restart apache2</code></pre>

        <h2 id="part10">–ß–ê–°–¢–¨ 10: COD-WEB (HTTPS —Å–∞–π—Ç) <span class="badge badge-astra">Astra Linux</span></h2>

        <pre><code>su -

apt install -y apache2

# –°–æ–∑–¥–∞–Ω–∏–µ —Å–∞–π—Ç–∞
mkdir -p /var/www/html
echo "<h1>Welcome to COD-WEB</h1>" > /var/www/html/index.html

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
  -keyout /etc/ssl/private/codweb.key \
  -out /etc/ssl/certs/codweb.crt \
  -subj "/C=RU/ST=SVE/L=EKB/O=COD/CN=152.32.66.0"

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ HTTPS
cat > /etc/apache2/sites-available/default-ssl.conf << 'EOF'
<VirtualHost *:443>
    ServerAdmin webmaster@localhost
    DocumentRoot /var/www/html

    SSLEngine on
    SSLCertificateFile /etc/ssl/certs/codweb.crt
    SSLCertificateKeyFile /etc/ssl/private/codweb.key

    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
</VirtualHost>
EOF

a2enmod ssl
a2ensite default-ssl
systemctl restart apache2</code></pre>

        <div class="info">
            <strong>üí° –ù–µ –∑–∞–±—É–¥—å:</strong> –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–æ–±—Ä–æ—Å –ø–æ—Ä—Ç–æ–≤ –Ω–∞ COD-RTR —á–µ—Ä–µ–∑ nftables –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–∞–π—Ç—É –ø–æ –≤–Ω–µ—à–Ω–µ–º—É IP
        </div>

        <h2 id="part11">–ß–ê–°–¢–¨ 11: OpenVPN –¥–ª—è REMOTE-WORKER <span class="badge badge-important">–í–∞–∂–Ω–æ</span></h2>

        <h3>11.1. –≠–∫—Å–ø–æ—Ä—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞ (–Ω–∞ COD-RTR)</h3>
        <pre><code>cd /etc/openvpn/easy-rsa

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
./easyrsa build-client-full remote-worker nopass

# –°–æ–∑–¥–∞–Ω–∏–µ .ovpn —Ñ–∞–π–ª–∞
cat > /root/remote-worker.ovpn << EOF
client
dev tun
proto udp
remote 152.32.66.0 1194
resolv-retry infinite
nobind
persist-key
persist-tun
cipher AES-256-CBC
verb 3

<ca>
$(cat pki/ca.crt)
</ca>

<cert>
$(cat pki/issued/remote-worker.crt)
</cert>

<key>
$(cat pki/private/remote-worker.key)
</key>
EOF</code></pre>

        <h3>11.2. –ù–∞ REMOTE-WORKER</h3>
        <pre><code>su -

apt install -y openvpn network-manager-openvpn-gnome

# –°–æ–∑–¥–∞–Ω–∏–µ —è—Ä–ª—ã–∫–∞ –Ω–∞ —Ä–∞–±–æ—á–µ–º —Å—Ç–æ–ª–µ
cat > /home/astra/Desktop/VPN-Connect.desktop << 'EOF'
[Desktop Entry]
Version=1.0
Type=Application
Name=Connect VPN
Exec=/usr/bin/openvpn --config /etc/openvpn/client/remote-worker.ovpn --daemon
Icon=network-vpn
Terminal=false
EOF

chmod +x /home/astra/Desktop/VPN-Connect.desktop

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
cat > /etc/systemd/system/vpn-reconnect.service << 'EOF'
[Unit]
Description=VPN Auto Reconnect
After=network-online.target

[Service]
Type=simple
ExecStart=/usr/bin/openvpn --config /etc/openvpn/client/remote-worker.ovpn --daemon
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
EOF

systemctl enable vpn-reconnect
systemctl start vpn-reconnect</code></pre>

        <h2 id="part12">–ß–ê–°–¢–¨ 12: COD-DOCKER (PRP + –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã) <span class="badge badge-astra">Astra Linux</span></h2>

        <h3>12.1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ PRP (–∞–≥—Ä–µ–≥–∞—Ü–∏—è –∫–∞–Ω–∞–ª–æ–≤)</h3>
        <pre><code>su -

apt install -y ifenslave

# –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª—è bonding
modprobe bonding

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ bonding
cat >> /etc/network/interfaces << 'EOF'
auto bond0
iface bond0 inet static
    address 10.10.20.200
    netmask 255.255.255.0
    gateway 10.10.20.1
    bond-slaves ens18 ens19
    bond-mode balance-rr
    bond-miimon 100
EOF

ifup bond0</code></pre>

        <h3>12.2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker</h3>
        <pre><code>apt install -y docker.io docker-compose

systemctl enable docker
systemctl start docker

# –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è –ü–õ–ö
mkdir -p /opt/plc-server

cat > /opt/plc-server/docker-compose.yml << 'EOF'
version: '3'
services:
  plc-server:
    image: nginx:latest
    ports:
      - "8080:80"
    volumes:
      - ./html:/usr/share/nginx/html
    restart: always
EOF

cd /opt/plc-server
docker-compose up -d</code></pre>

        <h3>12.3. –ê–Ω–∞–ª–∏–∑ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π (–¥–ª—è –æ—Ç—á–µ—Ç–∞)</h3>
        <div class="warning">
            <strong>üîç –ù–∞–π–¥–µ–Ω–Ω—ã–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –ü–õ–ö-—Å–µ—Ä–≤–µ—Ä–∞:</strong>
            <ol>
                <li>–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ HTTPS - –ø–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ</li>
                <li>–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –æ–±—Ä–∞–∑ nginx –±–µ–∑ hardening –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</li>
                <li>–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</li>
            </ol>
        </div>

        <h2 id="part13">–ß–ê–°–¢–¨ 13: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ <span class="badge badge-important">–ö—Ä–∏—Ç–∏—á–Ω–æ</span></h2>

        <h3>13.1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤—è–∑–Ω–æ—Å—Ç–∏</h3>
        <pre><code># –° COD-RTR
ping 192.168.1.10  # MAIN-DC1
ping 192.168.2.10  # MAIN-STORAGE1

# –° MAIN-RTR
ping 10.10.10.100  # CI-CD —Å–µ—Ç—å

# –ü—Ä–æ–≤–µ—Ä–∫–∞ OSPF
vtysh -c "show ip ospf neighbor"
vtysh -c "show ip route"</code></pre>

        <h3>13.2. –ü—Ä–æ–≤–µ—Ä–∫–∞ SSH –∏ Fail2ban</h3>
        <pre><code># –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è —Å –Ω–µ–≤–µ—Ä–Ω—ã–º –ø–∞—Ä–æ–ª–µ–º 3 —Ä–∞–∑–∞
ssh sshuser@<IP>

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–Ω
fail2ban-client status sshd</code></pre>

        <h3>13.3. –ü—Ä–æ–≤–µ—Ä–∫–∞ FreeIPA</h3>
        <pre><code># –ù–∞ PC1
kinit User1
# –í–≤–µ—Å—Ç–∏: P@ssw0rdAdmin

# –ü—Ä–æ–≤–µ—Ä–∫–∞ XRDP
xfreerdp /v:192.168.3.100 /u:User1@reaskills.cyber /p:P@ssw0rdAdmin</code></pre>

        <h3>13.4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ–±-—Å–µ—Ä–≤–∏—Å–æ–≤</h3>
        <pre><code># –ü—Ä–æ–≤–µ—Ä–∫–∞ COD-WEB
curl -k https://152.32.66.0

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
curl -k --user SuperUser100:P@ssw0rdTop https://www.reaskills.cyber</code></pre>

        <h2 id="checklist">‚úÖ –ö–û–ù–¢–†–û–õ–¨–ù–´–ô –°–ü–ò–°–û–ö</h2>

        <div class="checklist">
            <ul>
                <li>DNS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ 77.88.8.1</li>
                <li>–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π repo.external.ru –Ω–∞—Å—Ç—Ä–æ–µ–Ω</li>
                <li>–í—Å–µ L3 –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã —Å–æ–≥–ª–∞—Å–Ω–æ —Ç–æ–ø–æ–ª–æ–≥–∏–∏</li>
                <li>SSH –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è sshuser</li>
                <li>Fail2ban –Ω–∞—Å—Ç—Ä–æ–µ–Ω (2 –ø–æ–ø—ã—Ç–∫–∏, –±–∞–Ω 1 –º–∏–Ω—É—Ç–∞)</li>
                <li>auditd –ª–æ–≥–∏—Ä—É–µ—Ç SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</li>
                <li>OpenVPN —Ç—É–Ω–Ω–µ–ª—å –º–µ–∂–¥—É COD-RTR –∏ MAIN-RTR —Ä–∞–±–æ—Ç–∞–µ—Ç</li>
                <li>Wireguard –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∫–∞–∫ —Ä–µ–∑–µ—Ä–≤–Ω—ã–π VPN</li>
                <li>OSPF —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π</li>
                <li>–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–∞—Ä—à—Ä—É—Ç–æ–≤ –ø–∏—à–µ—Ç –≤ /var/log/router_change.log</li>
                <li>PAT (NAT) –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –æ–±–æ–∏—Ö —Ä–æ—É—Ç–µ—Ä–∞—Ö</li>
                <li>Rate limit 100 –ø–∞–∫–µ—Ç–æ–≤/—Å–µ–∫ –Ω–∞—Å—Ç—Ä–æ–µ–Ω</li>
                <li>COD-WEB –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ HTTPS —á–µ—Ä–µ–∑ –≤–Ω–µ—à–Ω–∏–π –∞–¥—Ä–µ—Å COD-RTR</li>
                <li>OpenVPN –¥–ª—è REMOTE-WORKER –Ω–∞—Å—Ç—Ä–æ–µ–Ω</li>
                <li>–Ø—Ä–ª—ã–∫ –∞–≤—Ç–æ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è VPN –Ω–∞ —Ä–∞–±–æ—á–µ–º —Å—Ç–æ–ª–µ</li>
                <li>FreeIPA –¥–æ–º–µ–Ω reaskills.cyber —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç</li>
                <li>–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ LDAP –≤ /mnt/backup-user.backup</li>
                <li>–ê—Ä—Ö–∏–≤ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω –ø–∞—Ä–æ–ª–µ–º BackupPa$$</li>
                <li>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–µ –Ω–∞ —Ä–∞–±–æ—á–µ–º –º–µ—Å—Ç–µ</li>
                <li>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ User1-40, User41-80, SuperUser100-130 —Å–æ–∑–¥–∞–Ω—ã</li>
                <li>–ü–∞—Ä–æ–ª—å–Ω–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ (–¥–ª–∏–Ω–∞ 10, –∏—Å—Ç–æ—Ä–∏—è 4, —Å—Ä–æ–∫ 31 –¥–µ–Ω—å)</li>
                <li>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å Petya —Å –∏—Å—Ç–µ—á–µ–Ω–∏–µ–º 15.05.2026 —Å–æ–∑–¥–∞–Ω</li>
                <li>PC1 –¥–æ–±–∞–≤–ª–µ–Ω –≤ –¥–æ–º–µ–Ω FreeIPA</li>
                <li>XRDP –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π FreeIPA</li>
                <li>Administrators –∏–º–µ—é—Ç –¥–æ—Å—Ç—É–ø –ø–æ XRDP —Å –≤—ã—Å–æ–∫–∏–º —É—Ä–æ–≤–Ω–µ–º —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏</li>
                <li>Worker –∏–º–µ—é—Ç –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ —Å –Ω–∏–∑–∫–∏–º —É—Ä–æ–≤–Ω–µ–º —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏</li>
                <li>–î–æ–º–∞—à–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –≤ /mnt/homes —á–µ—Ä–µ–∑ NFS</li>
                <li>–õ–æ–≥–∏ XRDP –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –Ω–∞ MAIN-DC1 –≤ /var/log/xrdp_audit.log</li>
                <li>–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –≤ /etc/ca –Ω–∞ MAIN-DC1</li>
                <li>NFS-–ø–∞–ø–∫–∞ /data –Ω–∞ MAIN-STORAGE1 –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–∞</li>
                <li>–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ /data-backup –Ω–∞ MAIN-STORAGE2</li>
                <li>–ö–æ–º–∞–Ω–¥–∞ save_all –∑–∞–ø—É—Å–∫–∞–µ—Ç –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ</li>
                <li>–í–µ–±-—Å–µ—Ä–≤–µ—Ä –Ω–∞ MAIN-STORAGE2 —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π —á–µ—Ä–µ–∑ LDAP</li>
                <li>–î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –¥–ª—è –≥—Ä—É–ø–ø—ã TopManager</li>
                <li>www.reaskills.cyber –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ HTTPS –±–µ–∑ –æ—à–∏–±–æ–∫ –≤ Firefox</li>
                <li>PRP (bonding) –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ COD-DOCKER</li>
                <li>–°–µ—Ä–≤–µ—Ä –¥–ª—è –ü–õ–ö —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç –≤ Docker</li>
                <li>3 —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –ü–õ–ö-—Å–µ—Ä–≤–µ—Ä–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã</li>
            </ul>
        </div>

        <div class="success">
            <h3>üéØ –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –°–û–í–ï–¢–´</h3>
            <ol>
                <li><strong>–ò—Å–ø–æ–ª—å–∑—É–π screen –∏–ª–∏ tmux</strong> –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Å–µ—Å—Å–∏—è–º–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ</li>
                <li><strong>–î–µ–ª–∞–π snapshot'—ã –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—à–∏–Ω</strong> –ø–µ—Ä–µ–¥ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏</li>
                <li><strong>–ü—Ä–æ–≤–µ—Ä—è–π –∫–∞–∂–¥—ã–π —à–∞–≥</strong> –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É</li>
                <li><strong>–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π –∏–∑–º–µ–Ω–µ–Ω–∏—è</strong> –≤ —á–µ—Ä–Ω–æ–≤–∏–∫–µ –¥–ª—è —ç–∫—Å–ø–µ—Ä—Ç–æ–≤</li>
                <li><strong>–°–ª–µ–¥–∏ –∑–∞ –≤—Ä–µ–º–µ–Ω–µ–º</strong> - –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –∑–∞–¥–∞—á–∏ –º–æ–∂–Ω–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –¥–ª—è –Ω–∞–±–æ—Ä–∞ –±–æ–ª—å—à–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –±–∞–ª–ª–æ–≤</li>
            </ol>
        </div>

        <div style="text-align: center; margin-top: 50px; padding: 30px; background: rgba(0, 212, 255, 0.1); border-radius: 10px;">
            <h2 style="color: #00d4ff; margin-bottom: 15px;">üöÄ –£–¥–∞—á–∏ –Ω–∞ —á–µ–º–ø–∏–æ–Ω–∞—Ç–µ REASkills 2026!</h2>
            <p style="color: #888;">–ê–≤—Ç–æ—Ä –≥–∞–π–¥–∞: Perplexity AI | –î–ª—è: Emiliano</p>
        </div>
    </div>

    <div class="scroll-top" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">
        ‚Üë
    </div>

    <script>
        // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ –¥–ª—è –∫–æ–º–∞–Ω–¥
        document.querySelectorAll('pre code').forEach((block) => {
            // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
            block.innerHTML = block.innerHTML.replace(/(#.*$)/gm, '<span style="color: #6a9955;">$1</span>');

            // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥
            block.innerHTML = block.innerHTML.replace(/^([a-z\-]+)/gm, '<span style="color: #569cd6;">$1</span>');
        });

        // –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –∫–Ω–æ–ø–∫—É –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –Ω–∞–≤–µ—Ä—Ö
        window.addEventListener('scroll', function() {
            const scrollTop = document.querySelector('.scroll-top');
            if (window.pageYOffset > 300) {
                scrollTop.style.display = 'flex';
            } else {
                scrollTop.style.display = 'none';
            }
        });
    </script>
</body>
</html>